<!DOCTYPE html><html lang="fr-FR"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="icon" href="/assets/images/logo.png"><title>Domotise le compteur d’eau Itron avec esp et cc1101 dans ha pour 10€ - Haade.fr</title><meta name="description" content="Domotiser pas à pas son compteur d’eau itron équipé d’un capteur 433mhz everblu cyble avec arduino dans homeassistant grâce un un module esp8266/esp32 et un émetteur/récepteur TI cc1101"><link rel="canonical" href="https://haade.fr/fr/blog/domotiser-compteur-eau-itron-everblu-cyble"><link rel="alternate" hreflang="en" href="https://haade.fr/en/blog/automate-water-meter-itron-everblu-cyble"/><link rel="alternate" hreflang="fr" href="https://haade.fr/fr/blog/domotiser-compteur-eau-itron-everblu-cyble"/><meta property="og:locale" content="fr-FR"><meta property="og:type" content="article"><meta property="og:title" content="Domotise le compteur d’eau Itron avec esp et cc1101 dans ha pour 10€"><meta property="og:description" content="Domotiser pas à pas son compteur d’eau itron équipé d’un capteur 433mhz everblu cyble avec arduino dans homeassistant grâce un un module esp8266/esp32 et un émetteur/récepteur TI cc1101"><meta property="og:url" content="https://haade.fr/fr/blog/domotiser-compteur-eau-itron-everblu-cyble"><meta property="og:site_name" content="Haade.fr"><meta property="og:image" content="https://haade.fr/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt.png"><meta property="article:author" content=""><meta property="article:published_time" content="2022-12-21T13:08:00+01:00"><meta property="article:modified_time" content="2022-12-28T17:43:00+01:00"> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "BlogPosting", "url": "https://haade.fr/fr/blog/domotiser-compteur-eau-itron-everblu-cyble", "name": "Domotise le compteur d'eau Itron avec esp et cc1101 dans ha pour 10€", "headline": "Domotise le compteur d'eau Itron avec esp et cc1101 dans ha pour 10€", "keywords": "Domotique,Haade-lab,Home-Assistant,Esp", "description": "Domotiser pas à pas son compteur d'eau itron équipé d'un capteur 433mhz everblu cyble avec arduino dans homeassistant grâce un un module esp8266/esp32 et un émetteur/récepteur TI cc1101", "articleBody": "Depuis peu la version 2022.11 de Homeassistant prend en charge le compteur d’énergie eau, il est possible de récupérer les données facilement à l’aide d’esp et ça pour 10€ environs. Dans mon cas le compteur est équipé d’un émetteur 433Mhz Itron Everblu Cyble 2.1. Ce qui permet de récupérer les données à l’aide d’un récepteur CC1101 accouplé à un esp8266/esp32 facilement. J’ai repris et modifié un référentiel complet sur github qui a été édité par psykokwak, et je félicite son travail. Ce référentiel permet de réceptionner les données et de les transférer par mqtt à homeassistant.\n\nPrérequis\n\n une carte esp8266\n un controleur CC1101\n un compteur d’eau Itron équipé d’un émetteur Itron Everblu cyble Enhanced\n home assistant v2022.11.0 mini\n\n\n\n \n \n \n \n \n\n\n \n \n \n Module esp wemos mini D1 pro avec antenne\n Par Estardyn\n Module de développement esp8266 réputé wemos D1 mini pro avec antenne afin de capter au mieux les ondes wifi\n \n \n \n \n Achetez\n \n \n\n\n\n\n \n \n \n \n \n\n\n \n \n \n Module de carte émetteur-récepteur RF sans fil CC1101, 315/433/868/915MHZ\n Par Texas Instrument\n Carte émetteur-récepteur RF sans fil CC1101, Module d'antenne SMA 315MHZ 433MHZ 868MHZ 915MHZ, Modulation 30ma GFSK MSK\n \n \n \n \n Achetez\n \n \n\n\n\nPréparation Arduino\n\nInstaller Arduino, étant sur linux je choisis l’appimage\nArduino Software\n\nInstallation librairies nécessaires\n\n1. Librairie des cartes ESP8266 et ESP32\n\nCommençons par installer la librairie de gestion des cartes esp8266 et esp32:\n\nlibrairie carte esp8266\nLibrairie carte esp32\n\n\n Fichier &gt; Préférences et collez l’url ci-dessus dans URL de gestionnaire de carte supplémentaire\n\n\n\n\n\n Outils &gt; carte &gt; gestionnaires de carte, cherchez esp8266 et esp32 et installez la dernière version Espressif\n\n\n\n\n2. Installer la librairie espmqttclient\n\n\n Outils &gt; Gérer les bibliothèques, cherchez espmqttclient et installez la dernière version\n\n\n\n\nSélectionner la bonne carte dans mon cas un wemos d1 mini pro sur port usb\n\n Branchez votre controlleur esp sur USB\n Dans le menu déroulant ajout carte /dev/USB0, commencez par sélectionner la carte et cochez le port correspondant.\n Pour terminer, Donne les permissions au port usb\n\n\nsudo usermod -a -G dialout #USER\nsudo chmod a+rw /dev/ttyUSB0\n\n\n\nCréer un nouveau sketch et importer le dossier\n\nMethode 1:\nTéléchargez le git, l’extraire et le glisser dans le dossier du sketch sur l’interface Arduino, sinon déposez le dossier directement à la racine du dossier Arduino.\n\nMethode2: En ligne de commande\n\ncd /home/nicolas/Arduino // placez-vous dans votre dossier arduino\ngit clone https://github.com/haade-administrator/watermeter2mqtt.git watermeter2mqtt\n\n\n \n \n \n \n Attention\n Veuillez à transférer le dossier portant le nom: watermeter2mqtt\n \n cliquez ici le lien du git\n \n\n\n\n\nConnection esp866 au CC011 dans mon cas un Wemos D1 Mini\n\n\n \n \n CC1101\n Wemos D1 mini\n NodeMCU\n ESP32\n \n \n \n \n VCC\n 3v3\n 3v3\n 3v3\n \n \n GOD0 (GDO0)\n D1, GPIO 5\n GPIO 5\n GPIO 22\n \n \n CSN (SPI chip select CS or SS)\n D8, GPIO 15\n GPIO 15\n GPIO 5 ou GPIO 15\n \n \n SCK (SPI clock)\n D5, GPIO 14\n GPIO 14\n GPIO 18 ou GPIO 14\n \n \n MOSI (SPI MOSI)\n D7, GPIO 13\n GPIO 13\n GPIO 23 ou GPIO 13\n \n \n GOD1 (SPI MISO)\n D6, GPIO 12\n GPIO 12\n GPIO 19 ou GPIO 12\n \n \n GOD2 (GDO2)\n D2, GPIO 4\n GPIO 4\n GPIO 21\n \n \n GND (ground)\n G\n GND\n GND\n \n \n\n\n\n\n\n Lien image NodeMcu Esp8266 GPIO\n Lien image Gpio Esp32 - 30 pin\n Lien image Gpio Esp32 - 30 pin\n\n\nParamétrons les fichiers avant vérification\n\nFichier watermeter2mqtt.ino\n\n1 Paramétrage wifi et mqtt\n\nEspMQTTClient mqtt(\n &quot;MyESSID&quot;, // Your Wifi SSID\n &quot;MyWiFiKey&quot;, // Your WiFi key\n &quot;mqtt.server.com&quot;, // MQTT Broker server ip\n &quot;MQTTUsername&quot;, // Can be omitted if not needed\n &quot;MQTTPassword&quot;, // Can be omitted if not needed\n &quot;watermetter2mqtt&quot;, // Client name that uniquely identify your device\n 1883 // MQTT Broker server port\n);\n\n2 ligne 88-90 réglage du relevé programmé\n\n Pour rappel ce code relève une fois par jour dans les heures ouvrés du releveur les données de consos.\nci dessous j’ai réglé sur 14h UTC ce qui correspond à 15h France\n\n\n// At 14:00 UTC\n if (ptm-&gt;tm_hour == 14 &amp;&amp; ptm-&gt;tm_min == 0 &amp;&amp; ptm-&gt;tm_sec == 0)\n\n3 choix du relevé programmé ou à chaque mise à jour des données\n\nPar défaut le script met à jour dès le changement de données modifier il suffit de décommenter onScheduled ligne 257 à 259 et de commenter onUpdateData\n\n// Note: on scheduled allows you to read the information once a day, onUpdateData allows you to read each time information changes\n // onScheduled();\n onUpdateData();\n\n4 trouver la bonne fréquence de votre emetteur CC1101\n\nIl suffit de décommenter le code ligne 272-291\n\n// Use this piece of code to find the right frequency.\n /*\n for (float i = 433.76f; i &lt; 433.890f; i += 0.0005f) {\n Serial.printf(&quot;Test frequency : %f\\n&quot;, i);\n cc1101_init(i);\n\n struct tmeter_data meter_data;\n meter_data = get_meter_data();\n\n if (meter_data.reads_counter != 0 || meter_data.liters != 0) {\n Serial.printf(&quot;\\n------------------------------\\nGot frequency : %f\\n------------------------------\\n&quot;, i);\n\n Serial.printf(&quot;Liters : %d\\nBattery (in months) : %d\\nCounter : %d\\n\\n&quot;, meter_data.liters, meter_data.battery_left, meter_data.reads_counter);\n\n digitalWrite(LED_BUILTIN, LOW); // turned on\n\n while (42);\n }\n }\n */\n\n\n\n cc1101_init(FREQUENCY);\n\n /*\n // Use this piece of code to test\n struct tmeter_data meter_data;\n meter_data = get_meter_data();\n Serial.printf(&quot;\\nLiters : %d\\nBattery (in months) : %d\\nCounter : %d\\nTime start : %d\\nTime end : %d\\n\\n&quot;, meter_data.liters, meter_data.battery_left, meter_data.reads_counter, meter_data.time_start, meter_data.time_end);\n while (42);\n */\n}\n\n\n\nPoussez le code sur votre module ensuite sélectionne Monitor série:\n\n\n\nle résultat doit être comme sur l’image ci-dessous:\n\n\n\n\n Une fois le code récupéré pense à commenter ces codes sinon tu ne pourras faire remonter les données ultérieurement.\n\n\n5 Paramétrer l’horloge sur sa région (Optionnel)\n\nAller à la ligne 188-190 si nécessaire\n\nconfigTzTime(&quot;CET-1CEST-2,M3.5.0/02:00:00,M10.5.0/03:00:00&quot;, &quot;pool.ntp.org&quot;);\n\nL’horloge est réglé sur paris, pour modifier en fonction de votre région copiez/collez le code dispo sur ce site\n\nFichier cc1101.cpp\n\nÉtape importante, faire correspondre les branchements du CC1001 au GPIO du module esp:\n\nCommençons par reprendre le schéma dispo plus haut, tu pourras te rendre compte que sur un Wemos D1 par exemple que SCK correspond au GPIO14, Miso 12 etc… sachant que ça modifie les lignes 94 à 100 du code dispo dans ce fichier. Voir le Gif animé ci-dessous:\n\n\n\nFichier everblu_meters.h\n\nCode dispo sur votre module itron pensez à ne pas reprendre le premier 0.\n\n\n\ntout en bas du fichier ligne 53-60\n\n// Change these define according to your hardware\n\n#define FREQUENCY 433.8683f // fréquence trouvée plus haut garde 4 chiffres après le point et rajoute f\n\n#define GDO0 5 // gpio 5 sur GDO0\n\n#define METER_YEAR 15 // année compteur \n#define METER_SERIAL 886451 // Code série sans le 0\n\nPousser le projet sur le module esp8266/esp32\n\nIl ne reste plus qu’à valider le projet croquis &gt; vérifier/compiler ou Ctrl+R, et si tout c’est bien passé vous devrier avoir en résultat\n\nExecutable segment sizes:\nICACHE : 32768 - flash instruction cache \nIROM : 331192 - code in flash (default or ICACHE_FLASH_ATTR) \nIRAM : 28877 / 32768 - code in IRAM (IRAM_ATTR, ISRs...) \nDATA : 1620 ) - initialized variables (global, static) in RAM/HEAP \nRODATA : 6680 ) / 81920 - constants (global, static) in RAM/HEAP \nBSS : 26968 ) - zeroed variables (global, static) in RAM/HEAP \nLe croquis utilise 368369 octets (35%) de l&#39;espace de stockage de programmes. Le maximum est de 1044464 octets.\nLes variables globales utilisent 35268 octets (43%) de mémoire dynamique, ce qui laisse 46652 octets pour les variables locales. Le maximum est de 81920 octets.\n\nEnsuite cliquez sur téléverser: croquis &gt; téléverser ou Ctrl+U\n\nrésultat:\n\nWrote 372528 bytes (266139 compressed) at 0x00000000 in 23.5 seconds (effective 126.9 kbit/s)...\nHash of data verified.\n\nLeaving...\nHard resetting via RTS pin...\n\nVérifie le monitor série\n\nDernière étape faire remonter l’info dans le compteur d’énergie\n\n\n Dans homeassistant va dans Paramètres &gt; Tableaux de bords &gt; Energies\n Ajouter une source d’eau\n Sélectionne Water meter index\n\n\n\n\nRésultat final dans conso Energie\n\n\n\nFoire aux questions\n\nCaractéristiques et fréquences des données\n\nce référentiel permet de récupérer:\n\n les volumes de consommations\n le niveau de la batterie de l’Everblu\n le nombre de relevé\n l’heure à laquelle ont été effectués les relevés.\n\n\nL’appareil interroge le compteur une fois par jour, toutes les 24 heures et réessaye toutes les heures si la requête a échoué.\nVotre compteur peut être configuré de telle sorte qu’il n’écoute les demandes que pendant les heures où les agents releveurs travaillent.Ceci fin d’économiser les batteries des modules. Si vous ne parvenez pas à communiquer avec le compteur, veuillez réessayer pendant les heures ouvrables (de 8h00 à 16h00), du lundi au vendredi. En règle générale, essayez de configurer votre appareil uniquement pendant les heures ouvrables, vous éviterez ainsi toute confusion.\n\nEtalonnage de la fréquence 433Mhz\n\nVotre module émetteur-récepteur n’est peut-être pas calibré correctement, veuillez modifier la fréquence un peu plus bas ou plus haut et réessayez. Vous pouvez utiliser RTL-SDR pour mesurer le décalage nécessaire. Vous pouvez décommenter la partie du code dans le watermeter2mqtt.ino ( voir plus haut ), fichier qui analyse toutes les fréquences autour de la fréquence du compteur pour trouver la bonne.\n\n\n \n \n \n \n \n\n\n \n \n \n Module esp wemos mini D1 pro avec antenne\n Par Estardyn\n Module de développement esp8266 réputé wemos D1 mini pro avec antenne afin de capter au mieux les ondes wifi\n \n \n \n \n Achetez\n \n \n\n\n\n\n \n \n \n \n \n\n\n \n \n \n Module de carte émetteur-récepteur RF sans fil CC1101, 315/433/868/915MHZ\n Par Texas Instrument\n Carte émetteur-récepteur RF sans fil CC1101, Module d'antenne SMA 315MHZ 433MHZ 868MHZ 915MHZ, Modulation 30ma GFSK MSK\n \n \n \n \n Achetez\n \n \n\n\n\nConclusion\n\nVoilà une méthode simple à mettre en place, pour ceux qui ne seont pas équipés d’un émetteur Itron Everblu Enhanced, il existe une autre méthode qui consiste à mettre un capteur inductif directement sur le compteur et de le relier à un esp8266, cette méthode est un peut plus contraignant car il faudra avoir une source d’énergie à proxilmité de ce compteur afin de pouvoir aliment en 5V l’esp et le capteur, le tarif de l’ensemble oscille autour de 10€, un excellent article est disponible ici pieterbrinkman.com\n\n", "datePublished": "2022-12-21 13:08:00 +0100", "dateModified": "2022-12-28 17:43", "inLanguage": "fr-FR", "author": { "@type": "Person", "name": null, "alternateName": null, "description": null, "url": null,"image": null,"email": null }, "publisher": { "@type": "Organization", "name": "Haade.fr", "url": "https://haade.fr", "logo": { "@type": "ImageObject", "width": 250, "height": 63, "url": "https://haade.fr/assets/images/logo.png" } }, "mainEntityOfPage": { "@type": "WebPage", "@id": "https://haade.fr/fr/blog/domotiser-compteur-eau-itron-everblu-cyble" }, "image": { "@type": "ImageObject", "width": 250, "height": 94, "url": "https://haade.fr/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt.png" } } </script><link href="/assets/css/theme.css?v=1714683641448110636" media="screen, projection, print" rel="stylesheet"> <script data-goatcounter="https://haade.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script><link rel="preload" href="/assets/fonts/montserrat/Montserrat-VariableFont_wght.woff2" as="font" crossorigin><link rel="preload" href="/assets/fonts/icomoon/icomoon.woff2?4fpajq" as="font" crossorigin><link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.ico" ><link rel="shortcut icon" type="image/png" href="/assets/images/favicon.png" ><header><div class="firstnavbar"><div class="links"> <a href="/">Accueil</a> <a href="/fr/rgpd-politique-de-confidentialite/">RGPD</a> <a href="/fr/contact/">Contact</a><div class="sl-nav"> langue:<ul><li><b>Francais</b> <i class="ico angle-down-solid triangle-arrow trrow" aria-hidden="true"></i><div class="triangle"></div><ul class="show-flags"><li class="current"><a href="/fr/blog/domotiser-compteur-eau-itron-everblu-cyble"><i class="sl-flag fix flag-fr"><div id="Francais"></div></i><span class="active">Francais</span></a><li><a href="/en/blog/automate-water-meter-itron-everblu-cyble"><i class="sl-flag fix flag-england"><div id="English"></div></i><span class="active">English</span></a></ul></ul></div></div><div class="social-firstnav"> <a href="https://github.com/haade-administrator/haade.fr/discussions" target="_blank" alt="github discussion link" aria-label="Continue la discussion sur le forum github"><i class="icob github" width="1em" height="1em" aria-hidden="true" title="github discussion"></i></a> <a href="https://www.youtube.com/channel/UCcXJ1ZsjEvQxuWJy7gH-A6w/?sub_confirmation=1" onclick="window.open(this.href, 'width=550,height=435');return false;" aria-label="Abonne toi à notre chaine youtube"><i class="icob youtube" width="1em" height="1em" target="_blank" alt="youtube" aria-hidden="true" title="youtube"></i></a> <a href="https://discord.gg/FaK6MuZ2" onclick="window.open(this.href, 'width=550,height=435');return false;" aria-label="Invitation sur notre réseau Discord"><i class="icob discord" width="1em" height="1em" target="_blank" alt="discord" aria-hidden="true" title="discord"></i></a> <a href="/fr/feed.xml" target="_blank" alt="feed rss" aria-label="partage le flux rss avec tes amis"><i class="icob rss" width="1em" height="1em" aria-hidden="true" title="feed rss haade"></i></a></div></div><div class="secondheader"> <a class="navbar-brand" href="/"><picture> <source sizes="(max-width: 524px) 150px, 250px" srcset="https://haade.fr/assets/images/generated/logo-150-379587352.webp 150w, https://haade.fr/assets/images/generated/logo-250-379587352.webp 250w" type="image/webp"> <source sizes="(max-width: 524px) 150px, 250px" srcset="https://haade.fr/assets/images/generated/logo-150-64f85a78e.png 150w, https://haade.fr/assets/images/generated/logo-250-64f85a78e.png 250w" type="image/png"> <img id="logoIImage" src="https://haade.fr/assets/images/generated/logo-250-64f85a78e.png" alt="Logo officiel du site domotique Haade" width="250" height="94"> </picture> </a><p class="sitetag"> Home Assistance Alsace domotique & électronique.</p></div><nav id="nav"><div class="navbar"> <i class='icos bars-solid'></i><div class="nav-links"><div class="sidebar-logo"> <span class="logo-name">H2Ade</span> <i class='icos times-solid'></i></div><ul class="links"><li><a href="/">Accueil<span class="badge badge-light tags">120</span></a><li> <a href="https://haade.fr/fr/categorie/domotique">Domotique</a> <i class="icos angle-down-solid htmlcss-arrow-automation arrow"></i><ul class="htmlCss-sub-menu-automation sub-menu"><li><a href="/fr/categorie/securite">Sécurité</a><li class="more"> <span><a href="/fr/categorie/haade-lab">Tutos</a> <i class='icos angle-right-solid arrow more-arrow-automation'></i> </span><ul class="more-sub-menu-automation sub-menu"><li><a href="/fr/categorie/mini-tutos">Mini-tutos</a><li><a href="/fr/categorie/videos">Vidéos</a><li><a href="/fr/categorie/home-assistant">Home-Assistant</a><li><a href="/fr/categorie/jeedom">Jeedom</a></ul></ul><li><a href="/fr/categorie/news">News</a><li><a href="/fr/categorie/tests">Tests</a><li><a href="/fr/auteurs">Contributeurs<span class="badge badge-primary">News</span></a><li><a target="_blank" href="https://github.com/haade-administrator/haade.fr/discussions">Forum</a><li><a href="/fr/categorie-produit/boutique">Boutique</a> <i class="icos angle-down-solid htmlcss-arrow-shop arrow"></i><ul class="htmlCss-sub-menu-shop sub-menu"><li class="more"> <span><a href="#">Marque</a> <i class='icos angle-right-solid arrow more-arrow-brand'></i> </span><ul class="more-sub-menu-brand sub-menu"><li><a href="/fr/categorie-produit/jeedom">Jeedom</a><li><a href="/fr/categorie-produit/moes">Moes</a><li><a href="/fr/categorie-produit/neo-coolcam">Neo-Coolcam</a><li><a href="/fr/categorie-produit/nodon">Nodon</a><li><a href="/fr/categorie-produit/raspberry-pi">Raspberry Pi</a><li><a href="/fr/categorie-produit/sonoff">Sonoff</a><li><a href="/fr/categorie-produit/tedee">Tedee</a><li><a href="/fr/categorie-produit/xiaomi">Xiaomi</a><li><a href="/fr/categorie-produit/zemismart">Zemismart</a></ul><li class="more"> <span><a href="#">Protocole</a> <i class='ico angle-right-solid arrow more-arrow-protocol'></i> </span><ul class="more-sub-menu-protocol sub-menu"><li><a href="/fr/categorie-produit/bluetooth">Bluetooth</a><li><a href="/fr/categorie-produit/esp">Esp 32/8266</a><li><a href="/fr/categorie-produit/matter">Matter</a><li><a href="/fr/categorie-produit/wifi">Wifi</a><li><a href="/fr/categorie-produit/zigbee">Zigbee</a><li><a href="/fr/categorie-produit/zwave">Z-wave</a></ul></ul><li><div class="sl-nav"> langue:<ul><li><b>Francais</b> <i class="ico angle-down-solid triangle-arrow trrow" aria-hidden="true"></i><div class="triangle"></div><ul class="show-flags"><li class="current"><a href="/fr/blog/domotiser-compteur-eau-itron-everblu-cyble"><i class="sl-flag fix flag-fr"><div id="Francais"></div></i><span class="active">Francais</span></a><li><a href="/en/blog/automate-water-meter-itron-everblu-cyble"><i class="sl-flag fix flag-england"><div id="English"></div></i><span class="active">English</span></a></ul></ul></div></ul></div><script src="/assets/js/lunr.min.js?v=a944ea77ca394dff9a667d5aea56f0e9" type="text/javascript"></script><div class="search-box"> <i class='icos search-solid'></i><div class="input-box"> <form onSubmit="return lunr_search(document.getElementById('lunrsearch').value);" class="search-form" role="search"> <input autocomplete="on" id="lunrsearch" class="search-input" name="q" maxlength="200" placeholder="Recherche..." type="search" value=""> <input class="search-action" type="submit" value="Ok"> </form></div><div id="lunrsearchresults"><ul></ul></div></div></div></nav></header><div class="site-content"><div class="container"><div class="main-content"> <script> var addViews = "639"; var addViewsValue = parseInt(addViews); var r = new XMLHttpRequest(); r.addEventListener('load', function() { var visits = parseInt(JSON.parse(this.responseText).count.replace(/\s/g, '')); var totalVisits = visits; if (!isNaN(addViewsValue)) { totalVisits += addViewsValue; } document.getElementById('visits').innerText = totalVisits; }); r.open('GET', 'https://haade.goatcounter.com/counter/' + encodeURIComponent(location.pathname) + '.json'); r.send(); </script><div class="entry-header"><nav class="ariane"><ol class="arianefil" itemscope itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"> <a itemprop="item" href="https://haade.fr/"><span itemprop="name">Accueil</span></a><meta itemprop="position" content="1"><li><span class="prompt">&nbsp; > &nbsp;</span><li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a itemprop="item" href="https://haade.fr/fr/categorie/domotique"><span itemprop="name">Domotique</span></a><meta itemprop="position" content="2"><li><span class="prompt">&nbsp; > &nbsp;</span><li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a itemprop="item" href="https://haade.fr/fr/categorie/haade-lab"><span itemprop="name">Haade-lab</span></a><meta itemprop="position" content="3"><li><span class="prompt">&nbsp; > &nbsp;</span><li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a itemprop="item" href="https://haade.fr/fr/categorie/home-assistant"><span itemprop="name">Home-Assistant</span></a><meta itemprop="position" content="4"><li><span class="prompt">&nbsp; > &nbsp;</span>Domotise le compteur d'eau Itron avec esp et cc1101 dans ha pour 10€</ol></nav><h1 class="posttitle">Domotise le compteur d'eau Itron avec esp et cc1101 dans ha pour 10€</h1><div class="d-flex align-items-start mt-4"><div class="authorpost"> <a href="/fr/auteur-nico"><picture> <source srcset="https://haade.fr/assets/images/generated/nico-60-477f2654d.webp 1.0x" type="image/webp"> <source srcset="https://haade.fr/assets/images/generated/nico-60-78aa7390f.jpg 1.0x" type="image/jpeg"> <img class="author-thumb" itemprop="image" width="60" height="60" src="https://haade.fr/assets/images/generated/nico-60-78aa7390f.jpg" alt="Nico"> </picture> </a> Écris par <a href="/fr/auteur-nico"><b>Nico</b></a></div><div class="readingpost">&nbsp;<i class="icos calendar-check" width="1em" height="1em"></i> <time datetime="2022-12-28T17:43:00+01:00">28 décembre 2022 &nbsp; </time> <span><span class="reading-time" title="Temps de Lecture estimé"> <i class="icos history" width="1em" height="1em"></i> <strong> 9 min</strong> de lecture </span> </span><p><i class="icos eye-solid" width="1em" height="1em"></i> Cet Article a été vu <span id="visits" style="font-weight:bold">...</span> fois</p></div></div></div><div class="entry-featured-image"><picture> <source sizes="(max-width: 480px) calc(100vw - 30px), (max-width: 768px) calc(100vw - 30px), (max-width: 1024px) 800px, (min-width: 1025px) 940px, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-300-d5ecc5ca9.webp 300w, https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-400-d5ecc5ca9.webp 400w, https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-500-d5ecc5ca9.webp 500w, https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-600-d5ecc5ca9.webp 600w, https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-700-d5ecc5ca9.webp 700w, https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-800-d5ecc5ca9.webp 800w, https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-900-d5ecc5ca9.webp 900w, https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-940-d5ecc5ca9.webp 940w" type="image/webp"> <source sizes="(max-width: 480px) calc(100vw - 30px), (max-width: 768px) calc(100vw - 30px), (max-width: 1024px) 800px, (min-width: 1025px) 940px, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-300-d5ecc5ca9.png 300w, https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-400-d5ecc5ca9.png 400w, https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-500-d5ecc5ca9.png 500w, https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-600-d5ecc5ca9.png 600w, https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-700-d5ecc5ca9.png 700w, https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-800-d5ecc5ca9.png 800w, https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-900-d5ecc5ca9.png 900w, https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-940-d5ecc5ca9.png 940w" type="image/png"> <img class="lazyload featured-image-post" width="940" height="529" itemprop="image" src="https://haade.fr/assets/images/generated/posts/33/domotize-water-meter-itron-everblu-energy-homeassistant-mqtt-940-d5ecc5ca9.png" alt="Domotise le compteur d'eau Itron avec esp et cc1101 dans ha pour 10€"> </picture></div><div class="article-post"><p><em></em></p><div class="toc mt-4 mb-4 lead"><h3 class="font-weight-bold">Sommaire</h3><ul class="table_of"><li class="toc"><a href="#prérequis" class="toc_anchor">Prérequis</a><li class="toc"><a href="#préparation-arduino" class="toc_anchor">Préparation Arduino</a><ul class="toc_sub"><li class="toc"><a href="#installer-arduino-étant-sur-linux-je-choisis-lappimage" class="toc_anchor">Installer Arduino, étant sur linux je choisis l’appimage</a><li class="toc"><a href="#installation-librairies-nécessaires" class="toc_anchor">Installation librairies nécessaires</a><li class="toc"><a href="#sélectionner-la-bonne-carte-dans-mon-cas-un-wemos-d1-mini-pro-sur-port-usb" class="toc_anchor">Sélectionner la bonne carte dans mon cas un wemos d1 mini pro sur port usb</a><li class="toc"><a href="#créer-un-nouveau-sketch-et-importer-le-dossier" class="toc_anchor">Créer un nouveau sketch et importer le dossier</a></ul></ul><li class="toc"><a href="#connection-esp866-au-cc011-dans-mon-cas-un-wemos-d1-mini" class="toc_anchor">Connection esp866 au CC011 dans mon cas un Wemos D1 Mini</a><li class="toc"><a href="#paramétrons-les-fichiers-avant-vérification" class="toc_anchor">Paramétrons les fichiers avant vérification</a><li class="toc"><a href="#pousser-le-projet-sur-le-module-esp8266esp32" class="toc_anchor">Pousser le projet sur le module esp8266/esp32</a><li class="toc"><a href="#dernière-étape-faire-remonter-linfo-dans-le-compteur-dénergie" class="toc_anchor">Dernière étape faire remonter l’info dans le compteur d’énergie</a><ul class="toc_sub"><li class="toc"><a href="#résultat-final-dans-conso-energie" class="toc_anchor">Résultat final dans conso Energie</a></ul></ul><li class="toc"><a href="#foire-aux-questions" class="toc_anchor">Foire aux questions</a><li class="toc"><a href="#conclusion" class="toc_anchor">Conclusion</a></ul></div><div class="content-post"><p>Depuis peu la <em>version 2022.11 de Homeassistant prend en charge le compteur d’énergie eau</em>, il est possible de récupérer les données facilement à l’aide d’esp et ça <strong>pour 10€ environs</strong>. Dans mon cas le compteur est équipé d’un émetteur 433Mhz Itron Everblu Cyble 2.1. Ce qui permet de récupérer les données à l’aide d’un récepteur CC1101 accouplé à un esp8266/esp32 facilement. J’ai repris et <strong>modifié</strong> un référentiel complet sur github qui a été édité par <em>psykokwak</em>, et je félicite son travail. <a href="https://github.com/haade-administrator/watermeter2mqtt.git" target="_blank">Ce référentiel permet de réceptionner les données et de les transférer par mqtt à homeassistant</a>.</p><h1 id="prérequis">Prérequis</h1><ul><li>une <a href="/fr/produit/wemos-d1-mini-pro-plus-antenne">carte esp8266</a><li>un <a href="/fr/produit/cc1101-recepteur-frequence-radio-433mhz">controleur CC1101</a><li>un compteur d’eau Itron équipé d’un émetteur <a href="https://www.itron.com/fr/solutions/product-catalog/everblu-cyble-enhanced" target="_blank">Itron Everblu cyble Enhanced</a><li>home assistant <a href="https://www.home-assistant.io/blog/2022/11/02/release-202211/#getting-insights-into-water-usage" target="_blank">v2022.11.0 mini</a></ul><div class="embedproduct"><div class="embedproduct-picture"><picture> <source sizes="(max-width: 480px) 250px, (max-width: 768px) 350px, (max-width: 1024px) 400px, (min-width: 1025px) 30vw, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-250-e66409c99.webp 250w, https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-350-e66409c99.webp 350w, https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-400-e66409c99.webp 400w, https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-444-e66409c99.webp 444w" type="image/webp" /> <source sizes="(max-width: 480px) 250px, (max-width: 768px) 350px, (max-width: 1024px) 400px, (min-width: 1025px) 30vw, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-250-e66409c99.jpg 250w, https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-350-e66409c99.jpg 350w, https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-400-e66409c99.jpg 400w, https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-444-e66409c99.jpg 444w" type="image/jpeg" /> <img class="lazyload" width="250" height="250" src="https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-400-e66409c99.jpg" alt="Module de développement esp8266 réputé wemos D1 mini pro avec antenne afin de capter au mieux les ondes wifi" /> </picture></div><div class="text"><div class="embedproduct-info"><h2 class="no_toc">Module esp wemos mini D1 pro avec antenne</h2><h3 class="no_toc">Par Estardyn</h3><p>Module de développement esp8266 réputé wemos D1 mini pro avec antenne afin de capter au mieux les ondes wifi</p></div><div class="embedproduct-price"><div class="embedaffiliate"> <span class="haadebutton" role="button"><a href="/fr/produit/wemos-d1-mini-pro-plus-antenne">Achetez</a></span></div></div></div></div><div class="embedproduct"><div class="embedproduct-picture"><picture> <source sizes="(max-width: 480px) 250px, (max-width: 768px) 350px, (max-width: 1024px) 400px, (min-width: 1025px) 30vw, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/shop/2132/cc1101-250-18adc84a3.webp 250w, https://haade.fr/assets/images/generated/shop/2132/cc1101-350-18adc84a3.webp 350w, https://haade.fr/assets/images/generated/shop/2132/cc1101-400-18adc84a3.webp 400w, https://haade.fr/assets/images/generated/shop/2132/cc1101-444-18adc84a3.webp 444w" type="image/webp" /> <source sizes="(max-width: 480px) 250px, (max-width: 768px) 350px, (max-width: 1024px) 400px, (min-width: 1025px) 30vw, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/shop/2132/cc1101-250-18adc84a3.jpg 250w, https://haade.fr/assets/images/generated/shop/2132/cc1101-350-18adc84a3.jpg 350w, https://haade.fr/assets/images/generated/shop/2132/cc1101-400-18adc84a3.jpg 400w, https://haade.fr/assets/images/generated/shop/2132/cc1101-444-18adc84a3.jpg 444w" type="image/jpeg" /> <img class="lazyload" width="250" height="250" src="https://haade.fr/assets/images/generated/shop/2132/cc1101-400-18adc84a3.jpg" alt="Carte émetteur-récepteur RF sans fil CC1101, Module d'antenne SMA 315MHZ 433MHZ 868MHZ 915MHZ, Modulation 30ma GFSK MSK" /> </picture></div><div class="text"><div class="embedproduct-info"><h2 class="no_toc">Module de carte émetteur-récepteur RF sans fil CC1101, 315/433/868/915MHZ</h2><h3 class="no_toc">Par Texas Instrument</h3><p>Carte émetteur-récepteur RF sans fil CC1101, Module d'antenne SMA 315MHZ 433MHZ 868MHZ 915MHZ, Modulation 30ma GFSK MSK</p></div><div class="embedproduct-price"><div class="embedaffiliate"> <span class="haadebutton" role="button"><a href="/fr/produit/cc1101-recepteur-frequence-radio-433mhz">Achetez</a></span></div></div></div></div><h1 id="préparation-arduino">Préparation Arduino</h1><h3 id="installer-arduino-étant-sur-linux-je-choisis-lappimage">Installer Arduino, étant sur linux je choisis l’appimage</h3><p><a href="https://www.arduino.cc/en/software" target="_blank">Arduino Software</a></p><h3 id="installation-librairies-nécessaires">Installation librairies nécessaires</h3><h4 id="1-librairie-des-cartes-esp8266-et-esp32">1. Librairie des cartes ESP8266 et ESP32</h4><p>Commençons par installer la librairie de gestion des cartes esp8266 et esp32:</p><p><a href="http://arduino.esp8266.com/stable/package_esp8266com_index.json" target="_blank">librairie carte esp8266</a> <a href="https://dl.espressif.com/dl/package_esp32_index.json" target="_blank">Librairie carte esp32</a></p><ul><li>Fichier &gt; Préférences et collez l’url ci-dessus dans URL de gestionnaire de carte supplémentaire</ul><p><img src="/assets/images/posts/33/add-preference-card-arduino.webp" alt="Installations des librairies de cartes" width="796" height="533" class="lazyload" /></p><ul><li>Outils &gt; carte &gt; gestionnaires de carte, cherchez <strong>esp8266 et esp32</strong> et installez la dernière version Espressif</ul><picture><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/add-esp8266-card-240-a2671b9d3.webp 240w, https://haade.fr/assets/images/generated/posts/33/add-esp8266-card-300-a2671b9d3.webp 300w, https://haade.fr/assets/images/generated/posts/33/add-esp8266-card-400-a2671b9d3.webp 400w, https://haade.fr/assets/images/generated/posts/33/add-esp8266-card-480-a2671b9d3.webp 480w, https://haade.fr/assets/images/generated/posts/33/add-esp8266-card-698-a2671b9d3.webp 698w, https://haade.fr/assets/images/generated/posts/33/add-esp8266-card-796-a2671b9d3.webp 796w" type="image/webp" /><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/add-esp8266-card-240-a2671b9d3.png 240w, https://haade.fr/assets/images/generated/posts/33/add-esp8266-card-300-a2671b9d3.png 300w, https://haade.fr/assets/images/generated/posts/33/add-esp8266-card-400-a2671b9d3.png 400w, https://haade.fr/assets/images/generated/posts/33/add-esp8266-card-480-a2671b9d3.png 480w, https://haade.fr/assets/images/generated/posts/33/add-esp8266-card-698-a2671b9d3.png 698w, https://haade.fr/assets/images/generated/posts/33/add-esp8266-card-796-a2671b9d3.png 796w" type="image/png" /><img class="pictinpost lazyload" width="796" height="533" src="https://haade.fr/assets/images/generated/posts/33/add-esp8266-card-240-a2671b9d3.png" alt="Installer librairies cartes esp8266" /></picture><h4 id="2-installer-la-librairie-espmqttclient">2. Installer la librairie espmqttclient</h4><ul><li>Outils &gt; Gérer les bibliothèques, cherchez espmqttclient et installez la dernière version</ul><picture><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/add-esp-mqtt-client-240-ea3b27409.webp 240w, https://haade.fr/assets/images/generated/posts/33/add-esp-mqtt-client-300-ea3b27409.webp 300w, https://haade.fr/assets/images/generated/posts/33/add-esp-mqtt-client-400-ea3b27409.webp 400w, https://haade.fr/assets/images/generated/posts/33/add-esp-mqtt-client-480-ea3b27409.webp 480w, https://haade.fr/assets/images/generated/posts/33/add-esp-mqtt-client-698-ea3b27409.webp 698w, https://haade.fr/assets/images/generated/posts/33/add-esp-mqtt-client-796-ea3b27409.webp 796w" type="image/webp" /><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/add-esp-mqtt-client-240-ea3b27409.png 240w, https://haade.fr/assets/images/generated/posts/33/add-esp-mqtt-client-300-ea3b27409.png 300w, https://haade.fr/assets/images/generated/posts/33/add-esp-mqtt-client-400-ea3b27409.png 400w, https://haade.fr/assets/images/generated/posts/33/add-esp-mqtt-client-480-ea3b27409.png 480w, https://haade.fr/assets/images/generated/posts/33/add-esp-mqtt-client-698-ea3b27409.png 698w, https://haade.fr/assets/images/generated/posts/33/add-esp-mqtt-client-796-ea3b27409.png 796w" type="image/png" /><img class="pictinpost lazyload" width="796" height="533" src="https://haade.fr/assets/images/generated/posts/33/add-esp-mqtt-client-240-ea3b27409.png" alt="Ajouter la librairie espmqttclient" /></picture><h3 id="sélectionner-la-bonne-carte-dans-mon-cas-un-wemos-d1-mini-pro-sur-port-usb">Sélectionner la bonne carte dans mon cas un wemos d1 mini pro sur port usb</h3><ol><li>Branchez votre controlleur esp sur USB<li>Dans le menu déroulant ajout carte /dev/USB0, commencez par sélectionner la carte et cochez le port correspondant.<li>Pour terminer, <strong>Donne les permissions au port usb</strong></ol><figure class="highlight"><pre><code class="language-shell" data-lang="shell">sudo usermod -a -G dialout #USER
sudo chmod a+rw /dev/ttyUSB0</code></pre></figure><picture><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/select-board-mcu-240-f1aa38be9.webp 240w, https://haade.fr/assets/images/generated/posts/33/select-board-mcu-300-f1aa38be9.webp 300w, https://haade.fr/assets/images/generated/posts/33/select-board-mcu-400-f1aa38be9.webp 400w, https://haade.fr/assets/images/generated/posts/33/select-board-mcu-480-f1aa38be9.webp 480w, https://haade.fr/assets/images/generated/posts/33/select-board-mcu-698-f1aa38be9.webp 698w, https://haade.fr/assets/images/generated/posts/33/select-board-mcu-796-f1aa38be9.webp 796w" type="image/webp" /><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/select-board-mcu-240-f1aa38be9.png 240w, https://haade.fr/assets/images/generated/posts/33/select-board-mcu-300-f1aa38be9.png 300w, https://haade.fr/assets/images/generated/posts/33/select-board-mcu-400-f1aa38be9.png 400w, https://haade.fr/assets/images/generated/posts/33/select-board-mcu-480-f1aa38be9.png 480w, https://haade.fr/assets/images/generated/posts/33/select-board-mcu-698-f1aa38be9.png 698w, https://haade.fr/assets/images/generated/posts/33/select-board-mcu-796-f1aa38be9.png 796w" type="image/png" /><img class="pictinpost lazyload" width="796" height="533" src="https://haade.fr/assets/images/generated/posts/33/select-board-mcu-240-f1aa38be9.png" alt="Sélectionner la carte esp8266" /></picture><h3 id="créer-un-nouveau-sketch-et-importer-le-dossier">Créer un nouveau sketch et importer le dossier</h3><p><strong>Methode 1:</strong> <a href="https://github.com/haade-administrator/watermeter2mqtt.git" target="_blank">Téléchargez le git</a>, l’extraire et le glisser dans le dossier du sketch sur l’interface Arduino, sinon déposez le dossier directement à la racine du dossier Arduino.</p><p><strong>Methode2:</strong> En ligne de commande</p><figure class="highlight"><pre><code class="language-shell" data-lang="shell">cd /home/nicolas/Arduino  // placez-vous dans votre dossier arduino
git clone https://github.com/haade-administrator/watermeter2mqtt.git watermeter2mqtt</code></pre></figure><div class="alert alert-warning" role="alert"><div class="alert-icon"> <i class="icos exclamation-circle-solid"></i></div><div class="alert-text"><h4 class="no_toc">Attention</h4><p>Veuillez à transférer le dossier portant le nom: <b>watermeter2mqtt</b></p><hr /> <a href="https://github.com/haade-administrator/watermeter2mqtt.git" target="_blank" class="alert-link">cliquez ici le lien du git</a></div></div><picture><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/folder-sketch-watermeter-240-4bb293a6f.webp 240w, https://haade.fr/assets/images/generated/posts/33/folder-sketch-watermeter-300-4bb293a6f.webp 300w, https://haade.fr/assets/images/generated/posts/33/folder-sketch-watermeter-400-4bb293a6f.webp 400w, https://haade.fr/assets/images/generated/posts/33/folder-sketch-watermeter-480-4bb293a6f.webp 480w, https://haade.fr/assets/images/generated/posts/33/folder-sketch-watermeter-698-4bb293a6f.webp 698w, https://haade.fr/assets/images/generated/posts/33/folder-sketch-watermeter-796-4bb293a6f.webp 796w" type="image/webp" /><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/folder-sketch-watermeter-240-4bb293a6f.png 240w, https://haade.fr/assets/images/generated/posts/33/folder-sketch-watermeter-300-4bb293a6f.png 300w, https://haade.fr/assets/images/generated/posts/33/folder-sketch-watermeter-400-4bb293a6f.png 400w, https://haade.fr/assets/images/generated/posts/33/folder-sketch-watermeter-480-4bb293a6f.png 480w, https://haade.fr/assets/images/generated/posts/33/folder-sketch-watermeter-698-4bb293a6f.png 698w, https://haade.fr/assets/images/generated/posts/33/folder-sketch-watermeter-796-4bb293a6f.png 796w" type="image/png" /><img class="pictinpost lazyload" width="796" height="533" src="https://haade.fr/assets/images/generated/posts/33/folder-sketch-watermeter-240-4bb293a6f.png" alt="Ajouter le dossier watermeter2mqtt au sketch arduino" /></picture><h1 id="connection-esp866-au-cc011-dans-mon-cas-un-wemos-d1-mini">Connection esp866 au CC011 dans mon cas un Wemos D1 Mini</h1><table><thead><tr><th><a href="https://s.click.aliexpress.com/e/_DEK1jt9" target="_blank">CC1101</a><th><a href="https://s.click.aliexpress.com/e/_Dc6fzTD" target="_blank">Wemos D1 mini</a><th><a href="https://s.click.aliexpress.com/e/_DBOXniR" target="_blank">NodeMCU</a><th><a href="https://s.click.aliexpress.com/e/_DBOXniR" target="_blank">ESP32</a><tbody><tr><td>VCC<td>3v3<td>3v3<td>3v3<tr><td>GOD0 (GDO0)<td>D1, GPIO 5<td>GPIO 5<td>GPIO 22<tr><td>CSN (SPI chip select CS or SS)<td>D8, GPIO 15<td>GPIO 15<td>GPIO 5 ou GPIO 15<tr><td>SCK (SPI clock)<td>D5, GPIO 14<td>GPIO 14<td>GPIO 18 ou GPIO 14<tr><td>MOSI (SPI MOSI)<td>D7, GPIO 13<td>GPIO 13<td>GPIO 23 ou GPIO 13<tr><td>GOD1 (SPI MISO)<td>D6, GPIO 12<td>GPIO 12<td>GPIO 19 ou GPIO 12<tr><td>GOD2 (GDO2)<td>D2, GPIO 4<td>GPIO 4<td>GPIO 21<tr><td>GND (ground)<td>G<td>GND<td>GND</table><picture><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/d1-mini-gpio-240-d24a9232b.webp 240w, https://haade.fr/assets/images/generated/posts/33/d1-mini-gpio-300-d24a9232b.webp 300w, https://haade.fr/assets/images/generated/posts/33/d1-mini-gpio-400-d24a9232b.webp 400w, https://haade.fr/assets/images/generated/posts/33/d1-mini-gpio-480-d24a9232b.webp 480w, https://haade.fr/assets/images/generated/posts/33/d1-mini-gpio-698-d24a9232b.webp 698w, https://haade.fr/assets/images/generated/posts/33/d1-mini-gpio-820-d24a9232b.webp 820w" type="image/webp" /><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/d1-mini-gpio-240-d24a9232b.png 240w, https://haade.fr/assets/images/generated/posts/33/d1-mini-gpio-300-d24a9232b.png 300w, https://haade.fr/assets/images/generated/posts/33/d1-mini-gpio-400-d24a9232b.png 400w, https://haade.fr/assets/images/generated/posts/33/d1-mini-gpio-480-d24a9232b.png 480w, https://haade.fr/assets/images/generated/posts/33/d1-mini-gpio-698-d24a9232b.png 698w, https://haade.fr/assets/images/generated/posts/33/d1-mini-gpio-820-d24a9232b.png 820w" type="image/png" /><img class="pictinpost lazyload" width="891" height="430" src="https://haade.fr/assets/images/generated/posts/33/d1-mini-gpio-240-d24a9232b.png" alt="GPIO Wemos d1 mini pin" /></picture><ol><li><a href="https://raw.githubusercontent.com/AchimPieters/ESP8266-12F---Power-Mode/master/Node-MCU-Pinout.png">Lien image NodeMcu Esp8266 GPIO</a><li><a href="https://raw.githubusercontent.com/AchimPieters/esp32-homekit-camera/master/Images/ESP32-30PIN-DEVBOARD.png">Lien image Gpio Esp32 - 30 pin</a><li><a href="https://raw.githubusercontent.com/AchimPieters/esp32-homekit-camera/master/Images/ESP32-38%20PIN-DEVBOARD.png">Lien image Gpio Esp32 - 30 pin</a></ol><h1 id="paramétrons-les-fichiers-avant-vérification">Paramétrons les fichiers avant vérification</h1><h4 id="fichier-watermeter2mqttino">Fichier watermeter2mqtt.ino</h4><p><strong>1 Paramétrage wifi et mqtt</strong></p><figure class="highlight"><pre><code class="language-yaml" data-lang="yaml">EspMQTTClient mqtt(
  &quot;MyESSID&quot;,            // Your Wifi SSID
  &quot;MyWiFiKey&quot;,          // Your WiFi key
  &quot;mqtt.server.com&quot;,    // MQTT Broker server ip
  &quot;MQTTUsername&quot;,       // Can be omitted if not needed
  &quot;MQTTPassword&quot;,       // Can be omitted if not needed
  &quot;watermetter2mqtt&quot;,      // Client name that uniquely identify your device
  1883                  // MQTT Broker server port
);</code></pre></figure><p><strong>2 ligne 88-90 réglage du relevé programmé</strong></p><blockquote><p>Pour rappel ce code relève une fois par jour dans les heures ouvrés du releveur les données de consos. <strong>ci dessous j’ai réglé sur 14h UTC ce qui correspond à 15h France</strong></p></blockquote><figure class="highlight"><pre><code class="language-yaml" data-lang="yaml">// At 14:00 UTC
  if (ptm-&gt;tm_hour == 14 &amp;&amp; ptm-&gt;tm_min == 0 &amp;&amp; ptm-&gt;tm_sec == 0)</code></pre></figure><p><strong>3 choix du relevé programmé ou à chaque mise à jour des données</strong></p><p>Par défaut le script met à jour dès le changement de données modifier il suffit de décommenter onScheduled ligne 257 à 259 et de commenter onUpdateData</p><figure class="highlight"><pre><code class="language-yaml" data-lang="yaml">// Note: on scheduled allows you to read the information once a day, onUpdateData allows you to read each time information changes
 // onScheduled();
  onUpdateData();</code></pre></figure><p><strong>4 trouver la bonne fréquence de votre emetteur CC1101</strong></p><p>Il suffit de décommenter le code ligne 272-291</p><figure class="highlight"><pre><code class="language-yaml" data-lang="yaml">// Use this piece of code to find the right frequency.
  /*
  for (float i = 433.76f; i &lt; 433.890f; i += 0.0005f) {
    Serial.printf(&quot;Test frequency : %f\n&quot;, i);
    cc1101_init(i);

    struct tmeter_data meter_data;
    meter_data = get_meter_data();

    if (meter_data.reads_counter != 0 || meter_data.liters != 0) {
      Serial.printf(&quot;\n------------------------------\nGot frequency : %f\n------------------------------\n&quot;, i);

      Serial.printf(&quot;Liters : %d\nBattery (in months) : %d\nCounter : %d\n\n&quot;, meter_data.liters, meter_data.battery_left, meter_data.reads_counter);

      digitalWrite(LED_BUILTIN, LOW); // turned on

      while (42);
    }
  }
  */



  cc1101_init(FREQUENCY);

  /*
  // Use this piece of code to test
  struct tmeter_data meter_data;
  meter_data = get_meter_data();
  Serial.printf(&quot;\nLiters : %d\nBattery (in months) : %d\nCounter : %d\nTime start : %d\nTime end : %d\n\n&quot;, meter_data.liters, meter_data.battery_left, meter_data.reads_counter, meter_data.time_start, meter_data.time_end);
  while (42);
  */
}</code></pre></figure><p><img src="/assets/images/posts/33/frequence-found.webp" alt="Trouver la bonne fréquence correspondant au module Everblu" width="838" height="613" class="lazyload" /></p><p>Poussez le code sur votre module ensuite sélectionne Monitor série:</p><picture><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/select-monitor-serie-240-ad49b1c1e.webp 240w, https://haade.fr/assets/images/generated/posts/33/select-monitor-serie-300-ad49b1c1e.webp 300w, https://haade.fr/assets/images/generated/posts/33/select-monitor-serie-400-ad49b1c1e.webp 400w, https://haade.fr/assets/images/generated/posts/33/select-monitor-serie-480-ad49b1c1e.webp 480w, https://haade.fr/assets/images/generated/posts/33/select-monitor-serie-698-ad49b1c1e.webp 698w, https://haade.fr/assets/images/generated/posts/33/select-monitor-serie-820-ad49b1c1e.webp 820w" type="image/webp" /><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/select-monitor-serie-240-ad49b1c1e.png 240w, https://haade.fr/assets/images/generated/posts/33/select-monitor-serie-300-ad49b1c1e.png 300w, https://haade.fr/assets/images/generated/posts/33/select-monitor-serie-400-ad49b1c1e.png 400w, https://haade.fr/assets/images/generated/posts/33/select-monitor-serie-480-ad49b1c1e.png 480w, https://haade.fr/assets/images/generated/posts/33/select-monitor-serie-698-ad49b1c1e.png 698w, https://haade.fr/assets/images/generated/posts/33/select-monitor-serie-820-ad49b1c1e.png 820w" type="image/png" /><img class="pictinpost lazyload" width="1115" height="577" src="https://haade.fr/assets/images/generated/posts/33/select-monitor-serie-240-ad49b1c1e.png" alt="Sélectionne monitor serie sur arduino ide" /></picture><p>le résultat doit être comme sur l’image ci-dessous:</p><picture><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/found-good-frequence-240-b202e5e11.webp 240w, https://haade.fr/assets/images/generated/posts/33/found-good-frequence-300-b202e5e11.webp 300w, https://haade.fr/assets/images/generated/posts/33/found-good-frequence-323-b202e5e11.webp 323w" type="image/webp" /><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/found-good-frequence-240-b202e5e11.png 240w, https://haade.fr/assets/images/generated/posts/33/found-good-frequence-300-b202e5e11.png 300w, https://haade.fr/assets/images/generated/posts/33/found-good-frequence-323-b202e5e11.png 323w" type="image/png" /><img class="pictinpost lazyload" width="323" height="363" src="https://haade.fr/assets/images/generated/posts/33/found-good-frequence-240-b202e5e11.png" alt="Trouver la bonne fréquence de connection au module itron everblu cyble" /></picture><blockquote><p>Une fois le code récupéré pense à commenter ces codes sinon tu ne pourras faire remonter les données ultérieurement.</p></blockquote><p><strong>5 Paramétrer l’horloge sur sa région</strong> <em>(Optionnel)</em></p><p>Aller à la ligne 188-190 <em>si nécessaire</em></p><figure class="highlight"><pre><code class="language-yaml" data-lang="yaml">configTzTime(&quot;CET-1CEST-2,M3.5.0/02:00:00,M10.5.0/03:00:00&quot;, &quot;pool.ntp.org&quot;);</code></pre></figure><p><em>L’horloge est réglé sur paris</em>, pour modifier en fonction de votre région <a href="https://sites.google.com/a/usapiens.com/opnode/time-zones" target="_blank">copiez/collez le code dispo sur ce site</a></p><h4 id="fichier-cc1101cpp">Fichier cc1101.cpp</h4><p>Étape importante, faire correspondre les branchements du CC1001 au GPIO du module esp:</p><p>Commençons par reprendre <a href="/fr/blog/domotiser-compteur-eau-itron-everblu-cyble#connection-esp866-au-cc011-dans-mon-cas-un-wemos-d1-mini">le schéma dispo plus haut</a>, tu pourras te rendre compte que sur un Wemos D1 par exemple que SCK correspond au GPIO14, Miso 12 etc… sachant que ça modifie les lignes 94 à 100 du code dispo dans ce fichier. Voir le Gif animé ci-dessous:</p><p><img src="/assets/images/posts/33/define-pin-cc1101-esp8266.webp" alt="Paramétrer les branchements du CC1101 au Wemos" width="529" height="298" class="lazyload" /></p><h4 id="fichier-everblu_metersh">Fichier everblu_meters.h</h4><p>Code dispo sur votre module itron <strong>pensez à ne pas reprendre le premier 0</strong>.</p><picture><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/itron-everblu-code-240-4fbc78ab9.webp 240w, https://haade.fr/assets/images/generated/posts/33/itron-everblu-code-300-4fbc78ab9.webp 300w, https://haade.fr/assets/images/generated/posts/33/itron-everblu-code-400-4fbc78ab9.webp 400w, https://haade.fr/assets/images/generated/posts/33/itron-everblu-code-480-4fbc78ab9.webp 480w, https://haade.fr/assets/images/generated/posts/33/itron-everblu-code-550-4fbc78ab9.webp 550w" type="image/webp" /><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/itron-everblu-code-240-4fbc78ab9.png 240w, https://haade.fr/assets/images/generated/posts/33/itron-everblu-code-300-4fbc78ab9.png 300w, https://haade.fr/assets/images/generated/posts/33/itron-everblu-code-400-4fbc78ab9.png 400w, https://haade.fr/assets/images/generated/posts/33/itron-everblu-code-480-4fbc78ab9.png 480w, https://haade.fr/assets/images/generated/posts/33/itron-everblu-code-550-4fbc78ab9.png 550w" type="image/png" /><img class="pictinpost lazyload" width="550" height="448" src="https://haade.fr/assets/images/generated/posts/33/itron-everblu-code-240-4fbc78ab9.png" alt="Trouver les codes itron Everblu" /></picture><p>tout en bas du fichier ligne 53-60</p><figure class="highlight"><pre><code class="language-yaml" data-lang="yaml">// Change these define according to your hardware

#define FREQUENCY 433.8683f  // fréquence trouvée plus haut garde 4 chiffres après le point et rajoute f

#define GDO0 5 // gpio 5 sur GDO0

#define METER_YEAR              15 // année compteur  
#define METER_SERIAL            886451 // Code série sans le 0</code></pre></figure><h1 id="pousser-le-projet-sur-le-module-esp8266esp32">Pousser le projet sur le module esp8266/esp32</h1><p>Il ne reste plus qu’à valider le projet croquis &gt; vérifier/compiler ou Ctrl+R, et si tout c’est bien passé vous devrier avoir en résultat</p><figure class="highlight"><pre><code class="language-shell" data-lang="shell">Executable segment sizes:
ICACHE : 32768           - flash instruction cache 
IROM   : 331192          - code in flash         (default or ICACHE_FLASH_ATTR) 
IRAM   : 28877   / 32768 - code in IRAM          (IRAM_ATTR, ISRs...) 
DATA   : 1620  )         - initialized variables (global, static) in RAM/HEAP 
RODATA : 6680  ) / 81920 - constants             (global, static) in RAM/HEAP 
BSS    : 26968 )         - zeroed variables      (global, static) in RAM/HEAP 
Le croquis utilise 368369 octets (35%) de l&#39;espace de stockage de programmes. Le maximum est de 1044464 octets.
Les variables globales utilisent 35268 octets (43%) de mémoire dynamique, ce qui laisse 46652 octets pour les variables locales. Le maximum est de 81920 octets.</code></pre></figure><p>Ensuite cliquez sur téléverser: croquis &gt; téléverser ou Ctrl+U</p><p>résultat:</p><figure class="highlight"><pre><code class="language-shell" data-lang="shell">Wrote 372528 bytes (266139 compressed) at 0x00000000 in 23.5 seconds (effective 126.9 kbit/s)...
Hash of data verified.

Leaving...
Hard resetting via RTS pin...</code></pre></figure><p><strong>Vérifie le monitor série</strong></p><h1 id="dernière-étape-faire-remonter-linfo-dans-le-compteur-dénergie">Dernière étape faire remonter l’info dans le compteur d’énergie</h1><ol><li>Dans homeassistant va dans Paramètres &gt; Tableaux de bords &gt; Energies<li>Ajouter une source d’eau<li>Sélectionne Water meter index</ol><p><img src="/assets/images/posts/33/parameter-watermeter-energy-ha.webp" alt="Paramétrer Consommation eau dans ha energie" width="657" height="287" class="lazyload" /></p><h3 id="résultat-final-dans-conso-energie">Résultat final dans conso Energie</h3><picture><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/conso-energie-ha-240-a0085b2fb.webp 240w, https://haade.fr/assets/images/generated/posts/33/conso-energie-ha-300-a0085b2fb.webp 300w, https://haade.fr/assets/images/generated/posts/33/conso-energie-ha-400-a0085b2fb.webp 400w, https://haade.fr/assets/images/generated/posts/33/conso-energie-ha-480-a0085b2fb.webp 480w, https://haade.fr/assets/images/generated/posts/33/conso-energie-ha-600-a0085b2fb.webp 600w" type="image/webp" /><source sizes="(max-width: 480px) 480px, (max-width: 768px) 698px, (max-width: 1024px) 820px, (min-width: 1025px) 820px" srcset="https://haade.fr/assets/images/generated/posts/33/conso-energie-ha-240-a0085b2fb.png 240w, https://haade.fr/assets/images/generated/posts/33/conso-energie-ha-300-a0085b2fb.png 300w, https://haade.fr/assets/images/generated/posts/33/conso-energie-ha-400-a0085b2fb.png 400w, https://haade.fr/assets/images/generated/posts/33/conso-energie-ha-480-a0085b2fb.png 480w, https://haade.fr/assets/images/generated/posts/33/conso-energie-ha-600-a0085b2fb.png 600w" type="image/png" /><img class="pictinpost lazyload" width="600" height="400" src="https://haade.fr/assets/images/generated/posts/33/conso-energie-ha-240-a0085b2fb.png" alt="Résultat final dans onglet conso energie" /></picture><h1 id="foire-aux-questions">Foire aux questions</h1><h4 id="caractéristiques-et-fréquences-des-données">Caractéristiques et fréquences des données</h4><p>ce référentiel permet de récupérer:</p><ol><li>les volumes de consommations<li>le niveau de la batterie de l’Everblu<li>le nombre de relevé<li>l’heure à laquelle ont été effectués les relevés.</ol><p>L’appareil interroge le compteur une fois par jour, toutes les 24 heures et réessaye toutes les heures si la requête a échoué. Votre compteur peut être configuré de telle sorte qu’il n’écoute les demandes que pendant les heures où les agents releveurs travaillent.<strong>Ceci fin d’économiser les batteries des modules</strong>. Si vous ne parvenez pas à communiquer avec le compteur, veuillez réessayer pendant les heures ouvrables (de 8h00 à 16h00), du lundi au vendredi. En règle générale, essayez de configurer votre appareil uniquement pendant les heures ouvrables, vous éviterez ainsi toute confusion.</p><h4 id="etalonnage-de-la-fréquence-433mhz">Etalonnage de la fréquence 433Mhz</h4><p>Votre module émetteur-récepteur n’est peut-être pas calibré correctement, veuillez modifier la fréquence un peu plus bas ou plus haut et réessayez. Vous pouvez utiliser RTL-SDR pour mesurer le décalage nécessaire. Vous pouvez décommenter la partie du code dans le watermeter2mqtt.ino ( voir plus haut ), fichier qui analyse toutes les fréquences autour de la fréquence du compteur pour trouver la bonne.</p><div class="embedproduct"><div class="embedproduct-picture"><picture> <source sizes="(max-width: 480px) 250px, (max-width: 768px) 350px, (max-width: 1024px) 400px, (min-width: 1025px) 30vw, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-250-e66409c99.webp 250w, https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-350-e66409c99.webp 350w, https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-400-e66409c99.webp 400w, https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-444-e66409c99.webp 444w" type="image/webp" /> <source sizes="(max-width: 480px) 250px, (max-width: 768px) 350px, (max-width: 1024px) 400px, (min-width: 1025px) 30vw, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-250-e66409c99.jpg 250w, https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-350-e66409c99.jpg 350w, https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-400-e66409c99.jpg 400w, https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-444-e66409c99.jpg 444w" type="image/jpeg" /> <img class="lazyload" width="250" height="250" src="https://haade.fr/assets/images/generated/shop/2131/WEMOS-Micro-carte-de-Developpement-WIFI-Connecteur-d-Antenne-Externe-Bas-sur-NodeMCU-D1-Mini-400-e66409c99.jpg" alt="Module de développement esp8266 réputé wemos D1 mini pro avec antenne afin de capter au mieux les ondes wifi" /> </picture></div><div class="text"><div class="embedproduct-info"><h2 class="no_toc">Module esp wemos mini D1 pro avec antenne</h2><h3 class="no_toc">Par Estardyn</h3><p>Module de développement esp8266 réputé wemos D1 mini pro avec antenne afin de capter au mieux les ondes wifi</p></div><div class="embedproduct-price"><div class="embedaffiliate"> <span class="haadebutton" role="button"><a href="/fr/produit/wemos-d1-mini-pro-plus-antenne">Achetez</a></span></div></div></div></div><div class="embedproduct"><div class="embedproduct-picture"><picture> <source sizes="(max-width: 480px) 250px, (max-width: 768px) 350px, (max-width: 1024px) 400px, (min-width: 1025px) 30vw, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/shop/2132/cc1101-250-18adc84a3.webp 250w, https://haade.fr/assets/images/generated/shop/2132/cc1101-350-18adc84a3.webp 350w, https://haade.fr/assets/images/generated/shop/2132/cc1101-400-18adc84a3.webp 400w, https://haade.fr/assets/images/generated/shop/2132/cc1101-444-18adc84a3.webp 444w" type="image/webp" /> <source sizes="(max-width: 480px) 250px, (max-width: 768px) 350px, (max-width: 1024px) 400px, (min-width: 1025px) 30vw, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/shop/2132/cc1101-250-18adc84a3.jpg 250w, https://haade.fr/assets/images/generated/shop/2132/cc1101-350-18adc84a3.jpg 350w, https://haade.fr/assets/images/generated/shop/2132/cc1101-400-18adc84a3.jpg 400w, https://haade.fr/assets/images/generated/shop/2132/cc1101-444-18adc84a3.jpg 444w" type="image/jpeg" /> <img class="lazyload" width="250" height="250" src="https://haade.fr/assets/images/generated/shop/2132/cc1101-400-18adc84a3.jpg" alt="Carte émetteur-récepteur RF sans fil CC1101, Module d'antenne SMA 315MHZ 433MHZ 868MHZ 915MHZ, Modulation 30ma GFSK MSK" /> </picture></div><div class="text"><div class="embedproduct-info"><h2 class="no_toc">Module de carte émetteur-récepteur RF sans fil CC1101, 315/433/868/915MHZ</h2><h3 class="no_toc">Par Texas Instrument</h3><p>Carte émetteur-récepteur RF sans fil CC1101, Module d'antenne SMA 315MHZ 433MHZ 868MHZ 915MHZ, Modulation 30ma GFSK MSK</p></div><div class="embedproduct-price"><div class="embedaffiliate"> <span class="haadebutton" role="button"><a href="/fr/produit/cc1101-recepteur-frequence-radio-433mhz">Achetez</a></span></div></div></div></div><h1 id="conclusion">Conclusion</h1><p>Voilà une méthode simple à mettre en place, pour ceux qui ne seont pas équipés d’un émetteur Itron Everblu Enhanced, il existe une autre méthode qui consiste à mettre un <a href="/fr/produit/capteur-inductif-5v-npn-LJ18A3-8Z" target="_blank">capteur inductif</a> directement sur le compteur et de le relier à un esp8266, cette méthode est un peut plus contraignant car il faudra avoir une source d’énergie à proxilmité de ce compteur afin de pouvoir aliment en 5V l’esp et le capteur, le tarif de l’ensemble oscille autour de 10€, un excellent article est disponible ici <a href="https://www.pieterbrinkman.com/2022/02/02/build-a-cheap-water-usage-sensor-using-esphome-home-assistant-and-a-proximity-sensor/" target="_blank">pieterbrinkman.com</a></p></div></div><div class="sourcelink"> <span class="titlesource">Articles source</span><ol><li class="contentlink"> <a rel="canonical" href="https://github.com/psykokwak-com/everblu-meters-esp8266" target="_blank">github.com</a><i class="icos external-link-alt-solid"></i><li class="contentlink"> <a rel="canonical" href="https://fr.macerobotics.com/developpeur/tutoriels/programmer-le-microcontroleur-esp8266-avec-lide-arduino/" target="_blank">fr.macerobotics.com</a><i class="icos external-link-alt-solid"></i><li class="contentlink"> <a rel="canonical" href="https://sites.google.com/a/usapiens.com/opnode/time-zones" target="_blank">sites.google.com</a><i class="icos external-link-alt-solid"></i><li class="contentlink"> <a rel="canonical" href="https://www.pieterbrinkman.com/2022/02/02/build-a-cheap-water-usage-sensor-using-esphome-home-assistant-and-a-proximity-sensor" target="_blank">www.pieterbrinkman.com</a><i class="icos external-link-alt-solid"></i></ol></div><div class="authorbox mb-5 mt-5 pt-4 pb-4" itemscope itemtype="https://schema.org/Person"><div class="row"><div class="wrapavname col-md-3 text-center"><picture> <source srcset="https://haade.fr/assets/images/generated/nico-110-477f2654d.webp 1.0x" type="image/webp"> <source srcset="https://haade.fr/assets/images/generated/nico-110-78aa7390f.jpg 1.0x" type="image/jpeg"> <img class="author-thumb" itemprop="image" width="110" height="110" src="https://haade.fr/assets/images/generated/nico-110-78aa7390f.jpg" alt="Nico"> </picture><p class="mt-4 mb-0 small text-center"> <a target="_blank" class="d-inline-block mx-1 text-dark" itemprop="url" href="/fr/auteur-nico/"><i class="ico link-solid"></i></a> <a target="_blank" class="d-inline-block mx-1 text-dark" itemprop="sameAs" href="https://www.youtube.com/channel/UCcXJ1ZsjEvQxuWJy7gH-A6w"><i class="icob youtube"></i></a> <a target="_blank" class="d-inline-block mx-1 text-dark" itemprop="sameAs" href="https://github.com/haade-administrator"><i class="icob github"></i></a> <a target="_blank" class="d-inline-block mx-1 text-dark" itemprop="sameAs" href="https://discordapp.com/widget?id=637642871738073091&theme=dark&username=Nicoxygen#5644"><i class="icob discord"></i></a> <a class="d-inline-block mx-1 text-dark" itemprop="email" href="mailto:nico@haade.fr"><i class="ico envelope-solid"></i></a></p></div><div class="col-md-9"><h4 itemprop="name">Nico</h4><p class="mt-3 mb-0" itemprop="description">Membre fondateur du site Haade, un passionné de domotique avec toutes les astuces qui vont biens.</p></div></div></div><div class="comments mt-5"> <button class="btn btn-outline-dark py-2 px-5 d-block w-100 show-comments"><i class="ico comments-solid text-muted"></i> &nbsp; Afficher les Commentaires</button><div id="comments"><h4 class="mb-4">commentaires</h4><script src="https://giscus.app/client.js" data-repo=haade-administrator/haade.fr data-repo-id=R_kgDOHxeeuA data-category=Comments data-category-id=DIC_kwDOHxeeuM4CTn1C data-mapping=title data-strict=1 data-reactions-enabled=1 data-emit-metadata=0 data-theme=light data-input-position=top data-loading=lazy data-lang=fr crossorigin=anonymous async> </script><div class="clearfix"></div></div></div><div class=" related-posts"><h2 class="text-center mb-4">Articles qui pourrait t'intéresser</h2><div class="d-flex justify-content-center align-items-center"> <a class="smoothscroll badge badge-primary text-capitalize" href="/fr/categorie/domotique">Domotique</a> <a class="smoothscroll badge badge-primary text-capitalize" href="/fr/categorie/haade-lab">Haade-lab</a> <a class="smoothscroll badge badge-primary text-capitalize" href="/fr/categorie/home-assistant">Home-Assistant</a> <a class="smoothscroll badge badge-primary text-capitalize" href="/fr/categorie/esp">Esp</a></div><div class="blog-grid-container"><div class="blog-grid-item"><div class="card h-100"><div class="maxthumb"> <a href="/fr/blog/changer-le-resultat-d-une-commande-d-attribut-d-etat-d-entite-par-une-autre-dans-home-assistant-avec-les-templates"><picture> <source sizes="(max-width: 480px) calc(100vw - 30px), (max-width: 768px) calc(100vw - 30px), (max-width: 1024px) calc(50vw - 15px), (min-width: 1025px) 25vw, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/posts/122/home-assistant-template-changer-resultat-d-une-commande-attributs-entite-par-une-autre-mini-tutos-haade-lab-300-0f04a1d1c.webp 300w, https://haade.fr/assets/images/generated/posts/122/home-assistant-template-changer-resultat-d-une-commande-attributs-entite-par-une-autre-mini-tutos-haade-lab-400-0f04a1d1c.webp 400w, https://haade.fr/assets/images/generated/posts/122/home-assistant-template-changer-resultat-d-une-commande-attributs-entite-par-une-autre-mini-tutos-haade-lab-500-0f04a1d1c.webp 500w, https://haade.fr/assets/images/generated/posts/122/home-assistant-template-changer-resultat-d-une-commande-attributs-entite-par-une-autre-mini-tutos-haade-lab-600-0f04a1d1c.webp 600w, https://haade.fr/assets/images/generated/posts/122/home-assistant-template-changer-resultat-d-une-commande-attributs-entite-par-une-autre-mini-tutos-haade-lab-700-0f04a1d1c.webp 700w, https://haade.fr/assets/images/generated/posts/122/home-assistant-template-changer-resultat-d-une-commande-attributs-entite-par-une-autre-mini-tutos-haade-lab-800-0f04a1d1c.webp 800w" type="image/webp"> <source sizes="(max-width: 480px) calc(100vw - 30px), (max-width: 768px) calc(100vw - 30px), (max-width: 1024px) calc(50vw - 15px), (min-width: 1025px) 25vw, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/posts/122/home-assistant-template-changer-resultat-d-une-commande-attributs-entite-par-une-autre-mini-tutos-haade-lab-300-0f04a1d1c.png 300w, https://haade.fr/assets/images/generated/posts/122/home-assistant-template-changer-resultat-d-une-commande-attributs-entite-par-une-autre-mini-tutos-haade-lab-400-0f04a1d1c.png 400w, https://haade.fr/assets/images/generated/posts/122/home-assistant-template-changer-resultat-d-une-commande-attributs-entite-par-une-autre-mini-tutos-haade-lab-500-0f04a1d1c.png 500w, https://haade.fr/assets/images/generated/posts/122/home-assistant-template-changer-resultat-d-une-commande-attributs-entite-par-une-autre-mini-tutos-haade-lab-600-0f04a1d1c.png 600w, https://haade.fr/assets/images/generated/posts/122/home-assistant-template-changer-resultat-d-une-commande-attributs-entite-par-une-autre-mini-tutos-haade-lab-700-0f04a1d1c.png 700w, https://haade.fr/assets/images/generated/posts/122/home-assistant-template-changer-resultat-d-une-commande-attributs-entite-par-une-autre-mini-tutos-haade-lab-800-0f04a1d1c.png 800w" type="image/png"> <img class="img-thumb lazyload" src="https://haade.fr/assets/images/generated/posts/122/home-assistant-template-changer-resultat-d-une-commande-attributs-entite-par-une-autre-mini-tutos-haade-lab-800-0f04a1d1c.png" alt="Changer le résultat d'un attribut d'état d'une entité" width="1200" height="675"> </picture> </a></div><div class="card-body"><h2 class="card-title"> <a class="text-dark" href="/fr/blog/changer-le-resultat-d-une-commande-d-attribut-d-etat-d-entite-par-une-autre-dans-home-assistant-avec-les-templates">Changer le résultat d'un attribut d'état d'une entité</a></h2><p class="card-text">Dans l’article précédent je t’avais montré comment créer une moyenne d’états sur entités, en faisant un appel sur un état d’entité states() qui relève directement l’état de cette entité. Aujourd’hui...</p></div><div class="card-footer bg-white"><div class="wrapfooter"> <span class="meta-footer-thumb"><picture> <source srcset="https://haade.fr/assets/images/generated/nico-40-477f2654d.webp 1.0x" type="image/webp"> <source srcset="https://haade.fr/assets/images/generated/nico-40-78aa7390f.jpg 1.0x" type="image/jpeg"> <img class="author-thumb" itemprop="image" width="40" height="40" src="https://haade.fr/assets/images/generated/nico-40-78aa7390f.jpg" alt="Nico"> </picture> </span> <span class="author-meta"> <a href="/fr/auteur-nico"><span class="post-name font-weight-bold">Nico</span></a> <span class="post-date">29 avril 2024</span> </span><div class="clearfix"></div></div></div></div></div><div class="blog-grid-item"><div class="card h-100"><div class="maxthumb"> <a href="/fr/blog/comparatif-youtube-robinet-thermostatique-moes-sonoff-aqara"><picture> <source sizes="(max-width: 480px) calc(100vw - 30px), (max-width: 768px) calc(100vw - 30px), (max-width: 1024px) calc(50vw - 15px), (min-width: 1025px) 25vw, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/posts/121/youtube-haade-labs-comparatif-robinet-thermostatique-moes-sonoff-aqara-300-c2f94f9ef.webp 300w, https://haade.fr/assets/images/generated/posts/121/youtube-haade-labs-comparatif-robinet-thermostatique-moes-sonoff-aqara-400-c2f94f9ef.webp 400w, https://haade.fr/assets/images/generated/posts/121/youtube-haade-labs-comparatif-robinet-thermostatique-moes-sonoff-aqara-500-c2f94f9ef.webp 500w, https://haade.fr/assets/images/generated/posts/121/youtube-haade-labs-comparatif-robinet-thermostatique-moes-sonoff-aqara-600-c2f94f9ef.webp 600w, https://haade.fr/assets/images/generated/posts/121/youtube-haade-labs-comparatif-robinet-thermostatique-moes-sonoff-aqara-700-c2f94f9ef.webp 700w, https://haade.fr/assets/images/generated/posts/121/youtube-haade-labs-comparatif-robinet-thermostatique-moes-sonoff-aqara-800-c2f94f9ef.webp 800w" type="image/webp"> <source sizes="(max-width: 480px) calc(100vw - 30px), (max-width: 768px) calc(100vw - 30px), (max-width: 1024px) calc(50vw - 15px), (min-width: 1025px) 25vw, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/posts/121/youtube-haade-labs-comparatif-robinet-thermostatique-moes-sonoff-aqara-300-c2f94f9ef.png 300w, https://haade.fr/assets/images/generated/posts/121/youtube-haade-labs-comparatif-robinet-thermostatique-moes-sonoff-aqara-400-c2f94f9ef.png 400w, https://haade.fr/assets/images/generated/posts/121/youtube-haade-labs-comparatif-robinet-thermostatique-moes-sonoff-aqara-500-c2f94f9ef.png 500w, https://haade.fr/assets/images/generated/posts/121/youtube-haade-labs-comparatif-robinet-thermostatique-moes-sonoff-aqara-600-c2f94f9ef.png 600w, https://haade.fr/assets/images/generated/posts/121/youtube-haade-labs-comparatif-robinet-thermostatique-moes-sonoff-aqara-700-c2f94f9ef.png 700w, https://haade.fr/assets/images/generated/posts/121/youtube-haade-labs-comparatif-robinet-thermostatique-moes-sonoff-aqara-800-c2f94f9ef.png 800w" type="image/png"> <img class="img-thumb lazyload" src="https://haade.fr/assets/images/generated/posts/121/youtube-haade-labs-comparatif-robinet-thermostatique-moes-sonoff-aqara-800-c2f94f9ef.png" alt="Comparatif Vidéo robinets thermostatiques Moes, Aqara et Sonoff" width="1200" height="675"> </picture> </a></div><div class="card-body"><h2 class="card-title"> <a class="text-dark" href="/fr/blog/comparatif-youtube-robinet-thermostatique-moes-sonoff-aqara">Comparatif Vidéo robinets thermostatiques Moes, Aqara et Sonoff</a></h2><p class="card-text">Suite à la vidéo économise du chauffage grâce à la domotique ça marche, August reviens avec à la clé un comparatif des robinets thermostatiques Moes ZTRV-BY-100, Aqara SRTS-A01 et Sonoff...</p></div><div class="card-footer bg-white"><div class="wrapfooter"> <span class="meta-footer-thumb"><picture> <source srcset="https://haade.fr/assets/images/generated/nico-40-477f2654d.webp 1.0x" type="image/webp"> <source srcset="https://haade.fr/assets/images/generated/nico-40-78aa7390f.jpg 1.0x" type="image/jpeg"> <img class="author-thumb" itemprop="image" width="40" height="40" src="https://haade.fr/assets/images/generated/nico-40-78aa7390f.jpg" alt="Nico"> </picture> </span> <span class="author-meta"> <a href="/fr/auteur-nico"><span class="post-name font-weight-bold">Nico</span></a> <span class="meta-footer-thumb"><picture> <source srcset="https://haade.fr/assets/images/generated/august-40-be997cfb5.webp 1.0x" type="image/webp"> <source srcset="https://haade.fr/assets/images/generated/august-40-280b2576b.png 1.0x" type="image/png"> <img class="author-thumb" itemprop="image" width="40" height="40" src="https://haade.fr/assets/images/generated/august-40-280b2576b.png" alt="August"> </picture> </span> <span class="author-meta"> <a href="/fr/auteur-august"><span class="post-name font-weight-bold">August</span></a> <span class="post-date">26 avril 2024</span> </span><div class="clearfix"></div></div></div></div></div><div class="blog-grid-item"><div class="card h-100"><div class="maxthumb"> <a href="/fr/blog/home-assistant-Template-faire-des-moyennes-de-plusieurs-entites"><picture> <source sizes="(max-width: 480px) calc(100vw - 30px), (max-width: 768px) calc(100vw - 30px), (max-width: 1024px) calc(50vw - 15px), (min-width: 1025px) 25vw, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/posts/119/creer-moyenne-etat-entite-template-home-assistant-300-0e6342f7a.webp 300w, https://haade.fr/assets/images/generated/posts/119/creer-moyenne-etat-entite-template-home-assistant-400-0e6342f7a.webp 400w, https://haade.fr/assets/images/generated/posts/119/creer-moyenne-etat-entite-template-home-assistant-500-0e6342f7a.webp 500w, https://haade.fr/assets/images/generated/posts/119/creer-moyenne-etat-entite-template-home-assistant-600-0e6342f7a.webp 600w, https://haade.fr/assets/images/generated/posts/119/creer-moyenne-etat-entite-template-home-assistant-700-0e6342f7a.webp 700w, https://haade.fr/assets/images/generated/posts/119/creer-moyenne-etat-entite-template-home-assistant-800-0e6342f7a.webp 800w" type="image/webp"> <source sizes="(max-width: 480px) calc(100vw - 30px), (max-width: 768px) calc(100vw - 30px), (max-width: 1024px) calc(50vw - 15px), (min-width: 1025px) 25vw, calc(100vw - 30px)" srcset="https://haade.fr/assets/images/generated/posts/119/creer-moyenne-etat-entite-template-home-assistant-300-0e6342f7a.png 300w, https://haade.fr/assets/images/generated/posts/119/creer-moyenne-etat-entite-template-home-assistant-400-0e6342f7a.png 400w, https://haade.fr/assets/images/generated/posts/119/creer-moyenne-etat-entite-template-home-assistant-500-0e6342f7a.png 500w, https://haade.fr/assets/images/generated/posts/119/creer-moyenne-etat-entite-template-home-assistant-600-0e6342f7a.png 600w, https://haade.fr/assets/images/generated/posts/119/creer-moyenne-etat-entite-template-home-assistant-700-0e6342f7a.png 700w, https://haade.fr/assets/images/generated/posts/119/creer-moyenne-etat-entite-template-home-assistant-800-0e6342f7a.png 800w" type="image/png"> <img class="img-thumb lazyload" src="https://haade.fr/assets/images/generated/posts/119/creer-moyenne-etat-entite-template-home-assistant-800-0e6342f7a.png" alt="Template - Créer une moyenne sur entités" width="1200" height="675"> </picture> </a></div><div class="card-body"><h2 class="card-title"> <a class="text-dark" href="/fr/blog/home-assistant-Template-faire-des-moyennes-de-plusieurs-entites">Template - Créer une moyenne sur entités</a></h2><p class="card-text">Pour notre premier tuto template, je te propose de créer des moyennes à partir de l’état des valeurs des entités ( sensor ). Dans mons cas j’ai besoin de faire...</p></div><div class="card-footer bg-white"><div class="wrapfooter"> <span class="meta-footer-thumb"><picture> <source srcset="https://haade.fr/assets/images/generated/nico-40-477f2654d.webp 1.0x" type="image/webp"> <source srcset="https://haade.fr/assets/images/generated/nico-40-78aa7390f.jpg 1.0x" type="image/jpeg"> <img class="author-thumb" itemprop="image" width="40" height="40" src="https://haade.fr/assets/images/generated/nico-40-78aa7390f.jpg" alt="Nico"> </picture> </span> <span class="author-meta"> <a href="/fr/auteur-nico"><span class="post-name font-weight-bold">Nico</span></a> <span class="post-date">11 avril 2024</span> </span><div class="clearfix"></div></div></div></div></div></div></div></div></div><footer><div class="footcontent"><div class="footleft footbox"><div class="footupper"><div class="foottopic">À Propos</div><p>Haade est un blog destiné à aider les particuliers et professionnels à la mise en place d’un système domotique</p></div><div class="footlower"><div class="foottopic">Contactez-nous</div><div class="phone"> <a href="#"><i class="icos phone-volume-solid"></i>+0033 6 99 40 15 86</a></div><div class="email"> <a href="/fr/contact"><i class="icos envelope-solid"></i>Formulaire de contact</a></div></div></div><div class="footmiddle footbox"><div class="foottopic">Liens utiles</div><div><a href="/fr/rgpd">Politique de confidentialité</a></div><div><a href="/fr/mentions-legales">Mentions legales</a></div><div><a target="_blank" href="https://buildwithmatter.com/">Protocole Matter</a></div><div><a target="_blank" href="https://zigbeealliance.org/fr/%C3%A9v%C3%A9nements/">Zigbee Alliance</a></div><div><a target="_blank" href="https://z-wavealliance.org/category/z-wave-in-the-news/">Z-wave Alliance</a></div><div><a target="_blank" href="https://www.aqara.com/eu/news.html">Aquara by Xiaomi</a></div><div><a target="_blank" href="https://itead.cc/">Itead Sonoff, Nextion</a></div></div><div class="footright footbox"><div class="foottopic">Inscrivez-vous à la Newsletter</div><form action="https://haade.us4.list-manage.com/subscribe/post?u=86f32891957737a57c0b4ade8&amp;id=92dadba2b4" method="post" name="" class="" target="_blank" novalidate> <input type="text" placeholder="Entrez une adresse e-mail"> <input type="submit" name="" value="Envoyer"><div class="media-icons"> <a href="https://github.com/haade-administrator/haade.fr/discussions" target="_blank" alt="github discussion link" aria-label="Continue la discussion sur le forum github"><i class="icob github" aria-hidden="true" title="github discussion"></i></a> <a target="_blank" href="https://www.youtube.com/channel/UCcXJ1ZsjEvQxuWJy7gH-A6w/?sub_confirmation=1" onclick="window.open(this.href, 'width=550,height=435');return false;" aria-label="Abonne toi à notre chaine youtube"><i class="icob youtube" aria-hidden="true" title="youtube"></i></a> <a target="_blank" href="https://discord.gg/FaK6MuZ2" onclick="window.open(this.href, 'width=550,height=435');return false;" aria-label="Invitation sur notre réseau Discord"><i class="icob discord" aria-hidden="true" title="discord"></i></a> <a href="/fr/feed.xml" target="_blank" alt="feed rss" aria-label="partage le flux rss avec tes amis"><i class="icob rss" aria-hidden="true" title="feed rss haade"></i></a></div></form></div></div><div class="footbottom"><p>Copyright © 2024 <a target="_blank" href="https://www.haade.fr">Haade</a> 🎉 by Nicoxygen</p></div></footer></div><script src="/assets/js/main.min.js?v=2b6bbb018bb501a889749f425d97675c" type="text/javascript"></script> <script src="/assets/js/lunrsearchengine-fr.js?v=ceef0e36504019105ad7abc454ff314e"></script>
