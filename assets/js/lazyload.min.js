!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.lazyLoad=t()}(this,function(){function e(e){var t=[],n=0;for(t=[],n=e.length;n;)t[--n]=e[n];return t}function t(e){e="SOURCE"===e.tagName?e.parentNode:e;var t=e.getBoundingClientRect();return t.bottom>0&&t.right>0&&t.left<(window.innerWidth||document.documentElement.clientWidth)&&t.top<(window.innerHeight||document.documentElement.clientHeight)}function n(e){e.removeAttribute("data-src"),e.removeAttribute("data-srcset"),e.removeAttribute("data-lazyload")}function o(){this.removeEventListener("load",o),n(this)}function a(e){var t=e.getAttribute("data-srcset"),a=e.getAttribute("data-src"),r=null!==e.getAttribute("data-lazyload");t&&(e.setAttribute("srcset",t),window.picturefill&&window.picturefill({elements:[e]})),a&&(e.src=a),r&&(e.setAttribute("data-lazyloaded",""),e.removeEventListener("load",o),n(e))}function r(e){0===s&&u.disconnect();for(var t=0;t<e.length;t++){var n=e[t];n.intersectionRatio>0&&(s--,u.unobserve(n.target),n.target.addEventListener("load",o,!1),a(n.target))}}function i(){var e;if("really-old"===m){for(s=v.length,e=0;e<s;e++)v[e]&&(a(v[e]),n(v[e]));v=[]}else if("old"===m){if(c===f.maxFrameCount){for(s=v.length,e=0;e<s;e++)if(v[e]&&void 0===v[e].lazyloaded&&t(v[e])){var d=v[e];v[e]=void 0,d.lazyloaded=!0,d.addEventListener("load",o,!1),a(d)}for(e=0;e<s;e++)void 0===v[e]&&v.splice(e,1);s=v.length,c=-1}s>0&&(c++,l=window.requestAnimationFrame(i))}else if("new"===m)for(u=new IntersectionObserver(r,{rootMargin:f.rootMargin,threshold:f.threshold}),s=v.length,e=0;e<s;e++)v[e]&&void 0===v[e].lazyloaded&&u.observe(v[e])}function d(){if("old"===m)try{cancelAnimationFrame(l)}catch(e){}else if("new"===m)try{u.disconnect()}catch(e){}v=e(document.querySelectorAll(f.elements)),s=v.length,c=f.maxFrameCount,i()}var l,c,s,u,m,f={pageUpdatedEventName:"page:updated",elements:"img[data-src], img[data-srcset], source[data-srcset], iframe[data-src], video[data-src], [data-lazyload]",rootMargin:"0px",threshold:0,maxFrameCount:10},v=[];return function(e){for(var t in e)e.hasOwnProperty(t)&&(f[t]=e[t]);m="addEventListener"in window&&window.requestAnimationFrame&&void 0!==typeof document.body.getBoundingClientRect?"IntersectionObserver"in window?"new":"old":"really-old",d(),f.pageUpdatedEventName&&document.addEventListener(f.pageUpdatedEventName,d,!0)}}),lazyLoad();